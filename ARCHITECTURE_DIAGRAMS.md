# üèóÔ∏è –î–∏–∞–≥—Ä–∞–º–º–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã Cloudhood

## –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```mermaid
graph TB
    subgraph "Browser Extension"
        SW[Service Worker<br/>background.ts]
        POPUP[Popup UI<br/>React App]
    end

    subgraph "React Application"
        APP[App.tsx]
        MAIN[Main Page]

        subgraph "Widgets Layer"
            HEADER[Header Widget]
            SIDEBAR[Sidebar Widget]
            HEADERS[Request Headers Widget]
            MODALS[Modals Widget]
        end

        subgraph "Features Layer"
            EXPORT[Export Profile]
            IMPORT[Import Profile]
            COPY[Copy Headers]
            CRUD[CRUD Headers]
        end

        subgraph "Entities Layer"
            PROFILE[Request Profile]
            NOTIFICATION[Notification]
            MODAL[Modal State]
            PAUSE[Pause State]
        end

        subgraph "Shared Layer"
            UTILS[Utils]
            COMPONENTS[Components]
            ASSETS[Assets]
        end
    end

    subgraph "External APIs"
        CHROME[Chrome Extension API]
        STORAGE[Chrome Storage]
        NET[Declarative Net Request]
    end

    %% Connections
    SW --> CHROME
    SW --> STORAGE
    SW --> NET

    APP --> MAIN
    MAIN --> HEADER
    MAIN --> SIDEBAR
    MAIN --> HEADERS
    MAIN --> MODALS

    HEADER --> EXPORT
    HEADER --> COPY
    SIDEBAR --> PROFILE
    HEADERS --> CRUD
    MODALS --> IMPORT

    EXPORT --> PROFILE
    IMPORT --> PROFILE
    COPY --> PROFILE
    CRUD --> PROFILE

    PROFILE --> STORAGE
    NOTIFICATION --> CHROME
    MODAL --> COMPONENTS
    PAUSE --> STORAGE

    UTILS --> CHROME
    UTILS --> STORAGE
    COMPONENTS --> ASSETS
```

## –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö Effector

```mermaid
graph LR
    subgraph "User Actions"
        UI[UI Components]
    end

    subgraph "Effector Events"
        EVENTS[Events<br/>createEvent]
    end

    subgraph "Effector Stores"
        STORES[Stores<br/>createStore]
    end

    subgraph "Effects"
        EFFECTS[Effects<br/>createEffect]
    end

    subgraph "External APIs"
        API[Chrome API<br/>Storage API]
    end

    UI --> EVENTS
    EVENTS --> STORES
    EVENTS --> EFFECTS
    STORES --> UI
    EFFECTS --> API
    API --> STORES
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Feature-Sliced Design

```mermaid
graph TD
    subgraph "App Layer"
        A[App.tsx<br/>–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è]
    end

    subgraph "Pages Layer"
        P[Main Page<br/>–ö–æ–º–ø–æ–∑–∏—Ü–∏—è –≤–∏–¥–∂–µ—Ç–æ–≤]
    end

    subgraph "Widgets Layer"
        W1[Header<br/>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è–º–∏]
        W2[Sidebar<br/>–°–ø–∏—Å–æ–∫ –ø—Ä–æ—Ñ–∏–ª–µ–π]
        W3[Request Headers<br/>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ]
        W4[Modals<br/>–î–∏–∞–ª–æ–≥–∏]
    end

    subgraph "Features Layer"
        F1[Export Profile<br/>–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö]
        F2[Import Profile<br/>–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö]
        F3[Copy Headers<br/>–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ]
        F4[CRUD Headers<br/>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏]
    end

    subgraph "Entities Layer"
        E1[Request Profile<br/>–û—Å–Ω–æ–≤–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å]
        E2[Notification<br/>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è]
        E3[Modal<br/>–°–æ—Å—Ç–æ—è–Ω–∏–µ –º–æ–¥–∞–ª–æ–∫]
        E4[Pause<br/>–°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–∞—É–∑—ã]
    end

    subgraph "Shared Layer"
        S1[Utils<br/>–£—Ç–∏–ª–∏—Ç—ã]
        S2[Components<br/>–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã]
        S3[Assets<br/>–†–µ—Å—É—Ä—Å—ã]
        S4[Constants<br/>–ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã]
    end

    %% Dependencies (only lower layers can import from higher layers)
    A --> P
    P --> W1
    P --> W2
    P --> W3
    P --> W4

    W1 --> F1
    W1 --> F3
    W2 --> E1
    W3 --> F4
    W4 --> F2

    F1 --> E1
    F2 --> E1
    F3 --> E1
    F4 --> E1

    F1 --> S1
    F2 --> S1
    F3 --> S1
    F4 --> S1

    E1 --> S1
    E2 --> S1
    E3 --> S1
    E4 --> S1

    W1 --> S2
    W2 --> S2
    W3 --> S2
    W4 --> S2
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Chrome Extension API

```mermaid
sequenceDiagram
    participant U as User
    participant UI as React UI
    participant SW as Service Worker
    participant API as Chrome API
    participant WEB as Web Page

    U->>UI: –ò–∑–º–µ–Ω—è–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å
    UI->>SW: –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ storage
    SW->>API: –û–±–Ω–æ–≤–ª—è–µ—Ç Declarative Net Request
    API->>WEB: –ü—Ä–∏–º–µ–Ω—è–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∫ –∑–∞–ø—Ä–æ—Å–∞–º

    Note over SW,API: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ<br/>–∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∫–æ –≤—Å–µ–º –∑–∞–ø—Ä–æ—Å–∞–º

    U->>UI: –ü–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å
    UI->>SW: –û–±–Ω–æ–≤–ª—è–µ—Ç selected profile
    SW->>API: –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø—Ä–∞–≤–∏–ª–∞
    API->>WEB: –ü—Ä–∏–º–µ–Ω—è–µ—Ç –Ω–æ–≤—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏
```

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º Effector

```mermaid
stateDiagram-v2
    [*] --> Initializing

    Initializing --> LoadingProfiles: initApp()
    LoadingProfiles --> ProfilesLoaded: loadProfiles()

    ProfilesLoaded --> ProfileSelected: selectProfile()
    ProfileSelected --> HeadersModified: modifyHeaders()
    HeadersModified --> HeadersSaved: saveHeaders()
    HeadersSaved --> ProfileSelected

    ProfileSelected --> ProfileExported: exportProfile()
    ProfileExported --> ProfileSelected

    ProfileSelected --> ProfileImported: importProfile()
    ProfileImported --> ProfilesLoaded

    ProfileSelected --> ProfileDeleted: deleteProfile()
    ProfileDeleted --> ProfilesLoaded

    ProfilesLoaded --> Paused: pauseAll()
    Paused --> ProfilesLoaded: resumeAll()

    ProfilesLoaded --> [*]: Extension closed
```

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ UI

```mermaid
graph TB
    subgraph "Main Page"
        MP[MainPage]
    end

    subgraph "Header Widget"
        H[Header]
        H1[ProfileNameField]
        H2[PauseAllRequestHeaders]
        H3[CopyActiveRequestHeaders]
    end

    subgraph "Sidebar Widget"
        S[Sidebar]
        S1[SetRequestProfile]
    end

    subgraph "Request Headers Widget"
        RH[RequestHeaders]
        RH1[RequestHeaderRow]
    end

    subgraph "Modals Widget"
        M[Modals]
        M1[ExportModal]
        M2[ImportModal]
        M3[ImportFromExtensionModal]
    end

    MP --> H
    MP --> S
    MP --> RH
    MP --> M

    H --> H1
    H --> H2
    H --> H3

    S --> S1

    RH --> RH1

    M --> M1
    M --> M2
    M --> M3
```

## –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤

```mermaid
sequenceDiagram
    participant U as User
    participant RH as RequestHeaders Widget
    participant CRUD as CRUD Feature
    participant PROFILE as Profile Entity
    participant SW as Service Worker
    participant API as Chrome API

    U->>RH: –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫
    RH->>CRUD: updateHeader()
    CRUD->>PROFILE: updateHeaderEvent()
    PROFILE->>PROFILE: –û–±–Ω–æ–≤–ª—è–µ—Ç store
    PROFILE->>SW: –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ storage
    SW->>API: –û–±–Ω–æ–≤–ª—è–µ—Ç Declarative Net Request
    API-->>U: –ó–∞–≥–æ–ª–æ–≤–∫–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –∫ –Ω–æ–≤—ã–º –∑–∞–ø—Ä–æ—Å–∞–º
```

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

- **–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤**: ~150
- **–°—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞**: ~15,000
- **TypeScript —Ñ–∞–π–ª—ã**: ~120
- **React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**: ~25
- **Effector stores**: ~15
- **Effector events**: ~30
- **–£—Ç–∏–ª–∏—Ç—ã**: ~20

## üéØ –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏

- **–ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏**: Unit tests –¥–ª—è —É—Ç–∏–ª–∏—Ç, E2E –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
- **–†–∞–∑–º–µ—Ä –±–∞–Ω–¥–ª–∞**: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π –±—Ä–∞—É–∑–µ—Ä–∞
- **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: Chrome + Firefox —á–µ—Ä–µ–∑ polyfill
